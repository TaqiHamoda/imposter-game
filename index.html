<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imposter Words - Strategy Edition</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üïµÔ∏è</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;700&display=swap');
        
        body {
            font-family: 'Space+Grotesk', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
        }

        .imposter-gradient {
            background: linear-gradient(135deg, #ef4444 0%, #991b1b 100%);
        }

        .innocent-gradient {
            background: linear-gradient(135deg, #10b981 0%, #064e3b 100%);
        }

        .tap-highlight {
            -webkit-tap-highlight-color: transparent;
        }

        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 0 20px 10px rgba(239, 68, 68, 0.2); }
        }

        .animate-pulse-red {
            animation: pulse-red 2s infinite;
        }

        .scale-in {
            animation: scaleIn 0.3s ease-out forwards;
        }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .custom-checkbox:checked + div {
            background-color: #ef4444;
            border-color: #ef4444;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="p-4 md:p-8 pb-24">

    <div id="app" class="max-w-2xl mx-auto space-y-6">
        <!-- Header -->
        <header class="text-center py-4">
            <h1 class="text-4xl font-bold tracking-tight text-white mb-1 uppercase italic">Imposter <span class="text-red-500">Words</span></h1>
            <p class="text-slate-400 text-sm">Strategic Pass-and-Play Game</p>
        </header>

        <!-- View 1: Setup -->
        <div id="view-setup" class="space-y-6">
            
            <!-- Players Section -->
            <div class="glass-card p-6">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2 text-slate-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
                    </svg>
                    Players
                </h2>
                <div class="flex gap-2 mb-4">
                    <input type="text" id="player-input" placeholder="Name..." class="flex-1 bg-slate-800 border border-slate-700 rounded-xl px-4 py-2 focus:outline-none focus:ring-2 focus:ring-red-500 transition-all">
                    <button onclick="addPlayer()" class="bg-red-600 hover:bg-red-500 px-6 py-2 rounded-xl font-bold transition-all active:scale-95 shadow-lg">Add</button>
                </div>
                <div id="player-list" class="flex flex-wrap gap-2"></div>
            </div>

            <!-- Words Section -->
            <div class="glass-card p-6">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2 text-slate-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
                        <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
                    </svg>
                    Add Word to Pool
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mb-4">
                    <input type="text" id="word-input" placeholder="Word (e.g. Cheese)" class="bg-slate-800 border border-slate-700 rounded-xl px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="text" id="category-input" placeholder="Category (e.g. Food)" class="bg-slate-800 border border-slate-700 rounded-xl px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="text" id="hint-input" placeholder="Hint (e.g. Switzerland)" class="bg-slate-800 border border-slate-700 rounded-xl px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <button onclick="addWord()" class="w-full bg-blue-600 hover:bg-blue-500 py-2 rounded-xl font-bold mb-4">Add Secret Word</button>
                
                <div id="word-list" class="flex flex-wrap gap-2 max-h-48 overflow-y-auto mb-4"></div>
                
                <div class="flex justify-between items-center text-[10px] text-slate-500 uppercase font-bold">
                    <button onclick="useDefaultWords()" class="hover:text-slate-300 underline">Load Defaults</button>
                    <span id="word-count">0 Words</span>
                </div>
            </div>

            <!-- Game Settings Section -->
            <div class="glass-card p-6 space-y-4">
                <h2 class="text-lg font-bold flex items-center gap-2 text-slate-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
                    </svg>
                    Game Settings
                </h2>

                <div class="flex items-center justify-between p-3 bg-slate-800/50 rounded-xl">
                    <span class="text-sm font-bold">Number of Imposters</span>
                    <div class="flex items-center gap-3">
                        <button id="imp-minus" onclick="changeImposterCount(-1)" class="w-8 h-8 bg-slate-700 rounded-lg font-bold transition-opacity">-</button>
                        <span id="imposter-count-display" class="w-6 text-center font-black text-red-500">1</span>
                        <button id="imp-plus" onclick="changeImposterCount(1)" class="w-8 h-8 bg-slate-700 rounded-lg font-bold transition-opacity">+</button>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <label class="flex items-center gap-3 p-3 bg-slate-800/50 rounded-xl cursor-pointer">
                        <input type="checkbox" id="set-show-category" class="hidden custom-checkbox" checked>
                        <div class="w-5 h-5 border-2 border-slate-600 rounded flex items-center justify-center transition-colors">‚úì</div>
                        <span class="text-xs font-bold uppercase">Imposter sees Category</span>
                    </label>
                    <label class="flex items-center gap-3 p-3 bg-slate-800/50 rounded-xl cursor-pointer">
                        <input type="checkbox" id="set-show-hint" class="hidden custom-checkbox">
                        <div class="w-5 h-5 border-2 border-slate-600 rounded flex items-center justify-center transition-colors">‚úì</div>
                        <span class="text-xs font-bold uppercase">Imposter sees Hint</span>
                    </label>
                </div>
            </div>

            <button id="start-btn" onclick="startGame()" disabled 
                class="w-full py-5 rounded-3xl font-black text-2xl transition-all disabled:opacity-30 disabled:grayscale bg-white text-slate-900 hover:bg-red-500 hover:text-white transform active:scale-95 shadow-2xl uppercase">
                Start Round
            </button>
        </div>

        <!-- View 2: The Reveal -->
        <div id="view-reveal" class="hidden glass-card p-8 text-center space-y-4 min-h-[550px] flex flex-col items-center justify-center border-2 border-red-500/20">
            
            <div id="reveal-header-nav" class="w-full opacity-0 pointer-events-none transition-all duration-300 h-14">
                <button onmouseup="nextPlayer()" ontouchend="nextPlayer()" 
                    class="w-full py-3 bg-white text-black rounded-xl font-black text-sm shadow-lg active:scale-95 transition-transform uppercase tracking-widest border-2 border-white">
                    Confirm & Next Player
                </button>
            </div>

            <div id="reveal-instructions" class="w-full space-y-8 py-10">
                <div>
                    <div class="mb-2 text-slate-500 uppercase tracking-widest font-bold text-xs">Hand Device To...</div>
                    <div id="current-player-name" class="text-5xl font-black text-white uppercase tracking-tighter drop-shadow-lg">NAME</div>
                </div>
                
                <div class="relative group w-full">
                    <button onmousedown="toggleSecret()" ontouchstart="toggleSecret()" 
                        class="bg-slate-800 hover:bg-red-900 w-full py-16 rounded-[2rem] text-xl font-black transition-all tap-highlight border-4 border-slate-700 active:border-red-500 active:scale-95 shadow-xl uppercase">
                        Click to Reveal
                    </button>
                </div>
            </div>

            <div id="secret-role" class="hidden scale-in w-full">
                <div id="role-card" class="p-10 rounded-[2rem] shadow-2xl w-full">
                    <div class="text-xs font-bold opacity-70 uppercase tracking-widest mb-2">IDENTIFIED AS</div>
                    <div id="role-text" class="text-5xl font-black uppercase mb-6 italic tracking-tight">ROLE</div>
                    
                    <div id="role-data-box" class="space-y-3">
                        <div id="reveal-category-box" class="bg-black/20 p-3 rounded-xl border border-white/5">
                            <div class="text-[9px] uppercase opacity-60 mb-1 font-bold">Category</div>
                            <div id="reveal-category-val" class="text-xl font-bold uppercase tracking-wide">FOOD</div>
                        </div>
                        <div id="reveal-word-box" class="bg-black/40 p-3 rounded-xl border border-white/10">
                            <div class="text-[9px] uppercase opacity-60 mb-1 font-bold">Secret Word</div>
                            <div id="reveal-word-val" class="text-3xl font-black uppercase tracking-widest text-white">PIZZA</div>
                        </div>
                        <div id="reveal-hint-box" class="bg-red-500/20 p-3 rounded-xl border border-red-500/20">
                            <div class="text-[9px] uppercase opacity-80 mb-1 font-bold">Imposter Hint</div>
                            <div id="reveal-hint-val" class="text-xl font-black uppercase text-red-200">ITALY</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- View 3: Match Start -->
        <div id="view-match-start" class="hidden glass-card p-6 md:p-10 text-center space-y-6 animate-in zoom-in duration-500 flex flex-col">
            <button onclick="backToSetup()" class="w-full py-3 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded-xl font-bold text-xs uppercase tracking-widest border border-slate-600 shadow-lg">
                Finish Round & Reset
            </button>

            <div class="space-y-2 pt-6">
                <div class="text-red-500 font-black text-xl uppercase tracking-widest">Active Round</div>
                <h2 class="text-3xl font-black uppercase italic">Find the Liar(s)!</h2>
            </div>
            
            <div class="bg-slate-800/50 p-8 rounded-3xl border border-slate-700 shadow-inner">
                <div class="text-xs text-slate-500 uppercase font-bold mb-4">Starts Discussion:</div>
                <div id="starter-name-display" class="text-5xl font-black text-blue-400 uppercase tracking-tighter">NAME</div>
                <p class="mt-4 text-sm text-slate-400">Speak your mind, but keep your secrets.</p>
            </div>
        </div>

        <!-- Leaderboard (Only shown in Setup/Post-Game) -->
        <div id="leaderboard-section" class="space-y-4">
            <button onclick="toggleStats()" class="w-full py-3 bg-slate-800/50 hover:bg-slate-800 rounded-xl text-xs font-bold text-slate-400 tracking-widest uppercase border border-slate-700/50 transition-all">
                <span id="toggle-icon">‚ñº</span> <span id="toggle-text">Show Fairness Leaderboard</span>
            </button>
            <div id="stats-container" class="hidden space-y-4">
                <!-- Recent Highlight -->
                <div id="recent-imposter-box" class="hidden glass-card p-4 border-l-4 border-l-red-500 flex items-center justify-between">
                    <div>
                        <div class="text-[10px] text-slate-500 uppercase font-bold">Most Recent Imposter(s)</div>
                        <div id="last-imposter-names" class="text-xl font-black text-white uppercase tracking-tight">NONE</div>
                    </div>
                    <div class="text-3xl">üé≠</div>
                </div>

                <div class="glass-card p-6">
                    <h3 class="text-[10px] font-bold mb-4 text-slate-500 tracking-widest uppercase">Imposter Frequency</h3>
                    <div id="stats-list" class="grid grid-cols-2 sm:grid-cols-3 gap-3"></div>
                </div>
            </div>
        </div>

        <!-- Master Wipe Button -->
        <div class="text-center pt-4 opacity-20 hover:opacity-100 transition-opacity">
            <button onclick="resetAll()" class="text-slate-600 hover:text-red-400 text-[10px] uppercase font-bold tracking-widest underline decoration-2 underline-offset-4">Wipe All Data</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-white text-black px-6 py-3 rounded-full text-sm font-black opacity-0 transition-all pointer-events-none shadow-2xl z-50">MESSAGE</div>

    <script>
        let players = [];
        let wordPool = [];
        let gameConfig = { imposterCount: 1, showCategory: true, showHint: false };
        let currentRound = { imposters: [], word: null, starter: null };
        let lastImposterNames = JSON.parse(localStorage.getItem('imp_last_names') || '[]');
        let currentPlayerIndex = 0;
        let isStatsVisible = false;

        const defaultWords = [
            { word: "Pizza", category: "Food", hint: "Italy" },
            { word: "Dinosaur", category: "History", hint: "Museum" },
            { word: "Submarine", category: "Transport", hint: "Yellow" },
            { word: "Volcano", category: "Nature", hint: "Magma" },
            { word: "Cinema", category: "Place", hint: "Popcorn" }
        ];

        window.onload = async () => {
            const savedPlayers = localStorage.getItem('imp_p_v5');
            const savedWords = localStorage.getItem('imp_w_v5');
            
            if (savedPlayers) players = JSON.parse(savedPlayers);            
            if (savedWords) wordPool = JSON.parse(savedWords);

            // Priority: Local Storage > data.json > defaultWords
            if (wordPool.length < 1) {
                try {
                    const response = await fetch('data.json');
                    if (response.ok) {
                        const jsonData = await response.json();
                        if (Array.isArray(jsonData) && jsonData.length > 0) {
                            wordPool = jsonData;
                        } else {
                            wordPool = [...defaultWords];
                        }
                    } else {
                        wordPool = [...defaultWords];
                    }
                } catch (e) {
                    wordPool = [...defaultWords];
                }
            }
            
            updatePlayerList();
            updateWordList();
            updateStats();
            updateRecentHighlight();
        };

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.style.opacity = '1';
            toast.style.transform = 'translate(-50%, -10px)';
            setTimeout(() => { toast.style.opacity = '0'; toast.style.transform = 'translate(-50%, 0)'; }, 2000);
        }

        // --- SETUP LOGIC ---
        function addPlayer() {
            const input = document.getElementById('player-input');
            const name = input.value.trim();
            if (!name) return;
            if (players.some(p => p.name.toLowerCase() === name.toLowerCase())) return showToast("Name taken!");
            players.push({ id: Date.now() + Math.random(), name: name, imposterCount: 0 });
            input.value = '';
            updatePlayerList();
            updateStats();
            saveData();
        }

        function removePlayer(id) {
            players = players.filter(p => p.id !== id);
            updatePlayerList();
            updateStats();
            saveData();
        }

        function updatePlayerList() {
            const list = document.getElementById('player-list');
            list.innerHTML = '';
            players.forEach(p => {
                const span = document.createElement('div');
                span.className = "flex items-center gap-2 bg-slate-800 text-white px-4 py-2 rounded-xl text-sm border border-slate-700 shadow-sm";
                span.innerHTML = `${p.name} <button onclick="removePlayer(${p.id})" class="text-slate-500 hover:text-red-500 font-bold ml-1">&times;</button>`;
                list.appendChild(span);
            });
            updateImposterLimit();
            checkStartAvailability();
        }

        function addWord() {
            const w = document.getElementById('word-input');
            const c = document.getElementById('category-input');
            const h = document.getElementById('hint-input');
            if (!w.value || !c.value || !h.value) return showToast("Fill all word fields!");
            wordPool.push({ word: w.value.trim(), category: c.value.trim(), hint: h.value.trim() });
            w.value = ''; c.value = ''; h.value = '';
            updateWordList();
            saveData();
        }

        function removeWord(index) {
            wordPool.splice(index, 1);
            updateWordList();
            saveData();
        }

        function useDefaultWords() {
            wordPool = [...defaultWords];
            updateWordList();
            saveData();
            showToast("Defaults loaded");
        }

        function updateWordList() {
            const list = document.getElementById('word-list');
            list.innerHTML = '';
            wordPool.forEach((w, idx) => {
                const div = document.createElement('div');
                div.className = "flex items-center gap-2 bg-blue-900/20 text-blue-300 px-3 py-1.5 rounded-lg text-xs border border-blue-800/30";
                div.innerHTML = `<span title="${w.category} / ${w.hint}">${w.word}</span> <button onclick="removeWord(${idx})" class="text-blue-600 hover:text-red-400 font-bold ml-1">&times;</button>`;
                list.appendChild(div);
            });
            document.getElementById('word-count').innerText = `${wordPool.length} Words`;
            checkStartAvailability();
        }

        function updateImposterLimit() {
            const n = players.length;
            const max = Math.max(1, Math.floor(n / 2) - 1);
            if (gameConfig.imposterCount > max) gameConfig.imposterCount = max;
            
            const minusBtn = document.getElementById('imp-minus');
            const plusBtn = document.getElementById('imp-plus');
            
            minusBtn.disabled = gameConfig.imposterCount <= 1;
            plusBtn.disabled = gameConfig.imposterCount >= max;
            
            minusBtn.className = `w-8 h-8 rounded-lg font-bold transition-all ${minusBtn.disabled ? "bg-slate-800 text-slate-600 opacity-50 cursor-not-allowed" : "bg-slate-700 hover:bg-slate-600 active:scale-90"}`;
            plusBtn.className = `w-8 h-8 rounded-lg font-bold transition-all ${plusBtn.disabled ? "bg-slate-800 text-slate-600 opacity-50 cursor-not-allowed" : "bg-slate-700 hover:bg-slate-600 active:scale-90"}`;
            
            document.getElementById('imposter-count-display').innerText = gameConfig.imposterCount;
        }

        function changeImposterCount(dir) {
            const n = players.length;
            const max = Math.max(1, Math.floor(n / 2) - 1);
            let next = gameConfig.imposterCount + dir;
            if (next < 1) next = 1;
            if (next > max) next = max;
            gameConfig.imposterCount = next;
            updateImposterLimit();
        }

        function checkStartAvailability() {
            const btn = document.getElementById('start-btn');
            const isValid = players.length >= 3 && wordPool.length >= 1;
            btn.disabled = !isValid;
        }

        // --- GAMEPLAY ENGINE ---
        function pickImposters(count) {
            let pool = [...players];
            let picks = [];
            for (let i = 0; i < count; i++) {
                if (pool.length === 0) break;
                const maxStat = Math.max(...pool.map(p => p.imposterCount), 1);
                const weights = pool.map(p => ({ id: p.id, w: Math.pow(2.5, maxStat - p.imposterCount) }));
                const total = weights.reduce((a, b) => a + b.w, 0);
                let r = Math.random() * total;
                let pick = null;
                for (let item of weights) {
                    if (r < item.w) { pick = item.id; break; }
                    r -= item.w;
                }
                picks.push(pick);
                pool = pool.filter(p => p.id !== pick);
            }
            return picks;
        }

        function startGame() {
            gameConfig.showCategory = document.getElementById('set-show-category').checked;
            gameConfig.showHint = document.getElementById('set-show-hint').checked;
            
            currentRound.imposters = pickImposters(gameConfig.imposterCount);
            currentRound.word = wordPool[Math.floor(Math.random() * wordPool.length)];
            currentRound.starter = players[Math.floor(Math.random() * players.length)];
            
            currentPlayerIndex = 0;
            players = players.sort(() => Math.random() - 0.5);
            
            document.getElementById('view-setup').classList.add('hidden');
            document.getElementById('view-reveal').classList.remove('hidden');
            document.getElementById('leaderboard-section').classList.add('hidden');
            showPlayerReveal();
        }

        function showPlayerReveal() {
            if (currentPlayerIndex >= players.length) return finalizeGame();
            const p = players[currentPlayerIndex];
            document.getElementById('current-player-name').innerText = p.name;
            document.getElementById('reveal-instructions').classList.remove('hidden');
            document.getElementById('secret-role').classList.add('hidden');
            document.getElementById('reveal-header-nav').classList.add('opacity-0', 'pointer-events-none');
        }

        function toggleSecret() {
            const p = players[currentPlayerIndex];
            const isImp = currentRound.imposters.includes(p.id);
            const roleCard = document.getElementById('role-card');
            
            document.getElementById('role-text').innerText = isImp ? "IMPOSTER" : "INNOCENT";
            roleCard.className = `p-10 rounded-[2rem] shadow-2xl w-full ${isImp ? 'imposter-gradient animate-pulse-red' : 'innocent-gradient'}`;

            document.getElementById('reveal-word-box').classList.toggle('hidden', isImp);
            document.getElementById('reveal-category-box').classList.toggle('hidden', isImp && !gameConfig.showCategory);
            document.getElementById('reveal-hint-box').classList.toggle('hidden', !isImp || !gameConfig.showHint);

            document.getElementById('reveal-word-val').innerText = currentRound.word.word;
            document.getElementById('reveal-category-val').innerText = currentRound.word.category;
            document.getElementById('reveal-hint-val').innerText = currentRound.word.hint;

            document.getElementById('reveal-instructions').classList.add('hidden');
            document.getElementById('secret-role').classList.remove('hidden');
            document.getElementById('reveal-header-nav').classList.remove('opacity-0', 'pointer-events-none');
        }

        function nextPlayer() {
            currentPlayerIndex++;
            showPlayerReveal();
        }

        function finalizeGame() {
            lastImposterNames = [];
            currentRound.imposters.forEach(id => {
                const p = players.find(p => p.id === id);
                if (p) {
                    p.imposterCount++;
                    lastImposterNames.push(p.name);
                }
            });
            saveData(); 
            updateStats();
            updateRecentHighlight();
            document.getElementById('view-reveal').classList.add('hidden');
            document.getElementById('view-match-start').classList.remove('hidden');
            document.getElementById('starter-name-display').innerText = currentRound.starter.name;
        }

        function backToSetup() {
            document.getElementById('view-match-start').classList.add('hidden');
            document.getElementById('view-setup').classList.remove('hidden');
            document.getElementById('leaderboard-section').classList.remove('hidden');
        }

        function toggleStats() {
            isStatsVisible = !isStatsVisible;
            document.getElementById('stats-container').classList.toggle('hidden', !isStatsVisible);
            document.getElementById('toggle-text').innerText = isStatsVisible ? "Hide Leaderboard" : "Show Fairness Leaderboard";
            document.getElementById('toggle-icon').innerText = isStatsVisible ? "‚ñ≤" : "‚ñº";
        }

        function updateRecentHighlight() {
            const box = document.getElementById('recent-imposter-box');
            const namesDisp = document.getElementById('last-imposter-names');
            if (lastImposterNames && lastImposterNames.length > 0) {
                box.classList.remove('hidden');
                namesDisp.innerText = lastImposterNames.join(", ");
            } else {
                box.classList.add('hidden');
            }
        }

        function updateStats() {
            const list = document.getElementById('stats-list');
            list.innerHTML = '';
            [...players].sort((a,b) => b.imposterCount - a.imposterCount).forEach(p => {
                const div = document.createElement('div');
                div.className = "bg-slate-900/50 p-3 rounded-xl border border-slate-800 text-center";
                div.innerHTML = `<div class="text-[10px] text-slate-500 font-bold uppercase">${p.name}</div><div class="text-2xl font-black ${p.imposterCount > 0 ? 'text-red-500' : 'text-slate-700'}">${p.imposterCount}</div>`;
                list.appendChild(div);
            });
        }

        function saveData() {
            localStorage.setItem('imp_p_v5', JSON.stringify(players));
            localStorage.setItem('imp_w_v5', JSON.stringify(wordPool));
            localStorage.setItem('imp_last_names', JSON.stringify(lastImposterNames));
        }

        function resetAll() {
            if (confirm("Wipe everything? This will reset all players, words, and history.")) {
                localStorage.clear(); location.reload();
            }
        }
    </script>
</body>
</html>
